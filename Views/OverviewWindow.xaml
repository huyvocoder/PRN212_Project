<Window x:Class="PRN212_Project.Views.OverviewWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PRN212_Project.Views"
        xmlns:vm="clr-namespace:PRN212_Project.ViewModels"
        mc:Ignorable="d"
        Title="Tổng quan tài chính" Height="600" Width="800">
    <Window.Resources>
        <!-- Đảm bảo LimitConverter của bạn được định nghĩa ở đây hoặc trong App.xaml -->
        <!-- Ví dụ: <local:LimitConverter x:Key="LimitConverter"/> -->
    </Window.Resources>
    <Window.DataContext>
        <vm:OverviewViewModel/>
    </Window.DataContext>
    <Grid Margin="10">
        <StackPanel>
            <Label Content="Tổng quan tài chính" FontWeight="Bold" Margin="0,0,0,5"/>
            <TextBlock Text="{Binding Balance, StringFormat=Total Balance: {0:C}}" FontWeight="Bold" Margin="0,0,0,10"/>
            <Button Content="Thêm thu nhập" Command="{Binding AddIncomeCommand}" Width="100" Margin="5"/>
            <Label Content="Danh mục" FontWeight="Bold" Margin="0,0,0,5"/>
            <ComboBox ItemsSource="{Binding MonthFilters}" SelectedItem="{Binding SelectedMonthFilter}" Width="150" Margin="0,0,0,10"/>
            <DataGrid ItemsSource="{Binding Categories}" AutoGenerateColumns="False" Height="150" Margin="0,0,0,10">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Tên" Binding="{Binding Name}"/>
                    <DataGridTextColumn Header="Định mức" Binding="{Binding MonthlyLimit, StringFormat=C}"/>
                    <DataGridTextColumn Header="Đã chi" Binding="{Binding CurrentSpent, StringFormat=C}"/>
                    <DataGridTemplateColumn Header="Hành động">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Thêm chi tiêu" Command="{Binding DataContext.AddExpenseCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding Id}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding CurrentSpent, Converter={StaticResource LimitConverter}}" Value="Red">
                                <Setter Property="Background" Value="LightCoral"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding CurrentSpent, Converter={StaticResource LimitConverter}}" Value="Yellow">
                                <Setter Property="Background" Value="LightYellow"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>
            </DataGrid>
            <Button Content="Quản lý danh mục" Command="{Binding ManageCategoriesCommand}" Width="150" Margin="5"/>
            <Button Content="Change Password" Command="{Binding ChangePasswordCommand}" Width="150" Margin="5"/>
            <!-- THÊM NÚT NÀY -->
            <Label Content="Lịch sử giao dịch" FontWeight="Bold" Margin="0,0,0,5"/>
            <DataGrid ItemsSource="{Binding Transactions}" AutoGenerateColumns="False" Height="150" Margin="0,0,0,10">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Ngày" Binding="{Binding Date, StringFormat=d}"/>
                    <DataGridTextColumn Header="Loại" Binding="{Binding Type}"/>
                    <DataGridTextColumn Header="Danh mục" Binding="{Binding Category.Name}"/>
                    <DataGridTextColumn Header="Số tiền" Binding="{Binding Amount, StringFormat=C}"/>
                    <DataGridTextColumn Header="Ghi chú" Binding="{Binding Note}"/>
                </DataGrid.Columns>
            </DataGrid>
            <Label Content="Thông báo" FontWeight="Bold" Margin="0,0,0,5"/>
            <DataGrid ItemsSource="{Binding Notifications}" AutoGenerateColumns="False" Height="100" Margin="0,0,0,10">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Thông báo" Binding="{Binding Message}"/>
                    <DataGridTextColumn Header="Ngày" Binding="{Binding Date, StringFormat=d}"/>
                    <DataGridTextColumn Header="Đã đọc" Binding="{Binding IsRead}"/>
                </DataGrid.Columns>
            </DataGrid>
            <Label Content="Lời khuyên tài chính" FontWeight="Bold" Margin="0,0,0,5"/>
            <TextBox Text="{Binding AIInput}" Width="300" Margin="0,0,0,10" TextWrapping="Wrap"/>
            <Button Content="Nhận lời khuyên" Command="{Binding GetAIAdviceCommand}" Width="100" Margin="5"/>
            <TextBlock Text="{Binding AIAdvice}" TextWrapping="Wrap" Margin="0,0,0,10"/>
        </StackPanel>
    </Grid>
</Window>
